<!doctype html>
<html lang="en">
<head>

	<meta charset="UTF-8">
	<title>Race Sign Up</title>
	<link rel="shortcut icon" href="/not-just-another-race-timer/favicon.ico" type="image/x-icon" />
	<script src= 
"/not-just-another-race-timer/utility/utility.js"> 
    </script> 
	<script src= 
"https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"> 
    </script>
    <link href="/not-just-another-race-timer/css/form.css" rel="stylesheet" type="text/css">
</head>
 


<body>
    
    <a href="/not-just-another-race-timer/"> Home </a>
    <br>
    <br>
            
    <form id="find_events" method="post" action="/">
        <input type="text" id="queryEventName" name="eventName" placeholder="Search Events by Keyword..."><br>
	    <input type="submit" value="Submit">
	</form>
	
	
	<div class="container-fluid" id = "querySummary">
    </div>
    <!-- This table displays the query results -->
	<div class="container-fluid" id = "eventTable">
    </div>
    

	 <script>
	 
	 
	 $(document).ready(function  () {
	 	$("#find_events").on("submit",function  (e) {
	 		e.preventDefault();
	 		let token = localStorage.getItem('token');
	 		let userID = localStorage.getItem('userID');
	 		//$(this).userID = userID;
	 		//$(this).token = token;
	 		var queryEventName = document.getElementById("queryEventName").value;
	 		var formAndAuth = $(this).serialize() + 
	 		            "&token=" + token +
	 		            "&userID=" + userID;
	 		console.log(formAndAuth);
	 		$.post("/not-just-another-race-timer/participate",formAndAuth, function(  data ) {
			  var divContainer = document.getElementById("eventTable");
			  var tblHTML = tableJSONtoHTML(data);
			  divContainer.innerHTML = "";
              divContainer.appendChild(tblHTML);
              
              // count events and display
              if(queryEventName == "") queryEventName = "all events";
              else queryEventName = "\"" + queryEventName + "\"";
              var querySummaryText = "Search for " + queryEventName + " returned " + data.length + " results."
			  var divContainer = document.getElementById("querySummary");
              divContainer.innerHTML = querySummaryText;
              
			});
	 	})
	 });
	 


 	</script>


</body>
 
</html>  
